---
layout: post
title: 一起来做chrome扩展《本地存储》
category: chrome扩展
description: chrome中的本地存储其实也是用的HTML5中localStorage，唯一区别是chrome扩展有自己的localStorage，它属于这个扩展，而不属于一个域名。得用这一点可以很好的处理扩展自己的一些数据，而不受访问网站和域名的影响。
img: 201501/01.png
keywords: chrome,extensions,localStorage,本地存储,扩展
---

<div class="col-sm-5">
	<div class="panel panel-success">
		<div class="panel-heading">目录</div>
		<div class="panel-body">
			<div class="list-group">
				<a href="#localStorage" class="list-group-item">1. localStorage基础</a>
				<a href="#chrome_extensions_localStorage" class="list-group-item">2. chrome扩展的localStorage</a>
				<a href="#chrome_extensions_localStorage_view" class="list-group-item">3. 查看localStorage</a>
				<a href="#ex" class="list-group-item">4. 简单示例</a>
			</div>
		</div>
	</div>
</div>
<p>
chrome中的本地存储其实也是用的HTML5中localStorage，唯一区别是chrome扩展有自己的localStorage，它属于这个扩展，而不属于一个域名。得用这一点可以很好的处理扩展自己的一些数据，而不受访问网站和域名的影响。
</p>

<h2 class="content_h2" id="localStorage">
localStorage基础
</h2>
<p>
localStorage是HTML5特性，所以有些浏览器不一定支持，不过我们这里讲的是chrome扩展，所以完全不用担心这个问题。如果想在WEB页面上使用，那就要检查一下是不是支持它
</p>
<p>
可以这样的检测：
</p>
<pre class="prettyprint lang-javascript">
if(window.localStorage){
	console.log('支持');
}else{
	console.log('不支持');
}
</pre>
<p>
localStorage和memcache一样，是key/value的存储类型，所以，除非你只存字符串，不然就得以json的形式来存储。之后解析成数组，就可以很好的使用里面的值。
</p>
<p>
增删改查：
</p>
<pre class="prettyprint lang-javascript">
// 存储/修改
localStorage.name = 'only';
localStorage['name'] = 'only';

// 删除
localStorage['name'] = null; 删除一个
localStorage.clear(); 删除所有

// 查
var name = localStorage.name;
var name = localStorage['name'];
</pre>
<p>
localStorage是不能跨域的，所以不同域名的localStorage是互不干扰的。比如在<a href="http://www.jgb.cn" target="_blank">jgb.com</a>上存储了一个值，在<a href="http://www.jgb.cn" target="_blank">www.jgb.com</a>是访问不了它的，反之亦然。
</p>

<h2 class="content_h2" id="chrome_extensions_localStorage">
chrome扩展中的localStorage
</h2>
<p>
扩展中的localStorage没什么不同，只是有一个注意点，content_script中的localStorage是存储在对应域名下的，所以别的域名是不能访问的。background_script中的localStorage是存储在chrome扩展下的，所以不管什么域名都可以访问它。这一点很重要，如果没有这个特性，扩展的应用场景就会少很多很多。
</p>

<h2 class="content_h2" id="chrome_extensions_localStorage_view">
查看localStorage
</h2>
<p>
查看对应域名的localStorage
</p>
<p>
右键选择审查元素，如图选择
</p>
<p>
<img src="/images/201501/02.png" alt="查看对应域名的localStorgae" />
</p>
<p>
查看扩展的localStorage
</p>
<p>
打开扩展界面，打开你扩展的背景页
</p>
<p>
<img src="/images/201501/03.png" alt="打开扩展的背景页" />
</p>
<p>
如图选择
</p>
<p>
<img src="/images/201501/04.png" alt="选择Resoures,local Storage" />
</p>
<h2 class="content_h2" id="ex">
简单示例
</h2>
<p>
这个示例很简单，扩展将匹配<a href="http://www.jgb.cn" target="_blank">www.jgb.cn</a>和www.amazon.com，打开两个网站后，会在页面中间显示一个列表和一个表单，列表是以前填入的名字，表单可以填入你名字另外的名字。列表里，可以删除一条，也可以删除所有名字。简单也讲，就是一个增删查。在这个例子中，可以看到，在<a href="http://www.jgb.cn" target="_blank">www.jgb.cn</a>和www.amazon.com中都是可以读取和操作这些存储内容的，不受域名的限制。
</p>
<h3>
第一步：建立文件夹
</h3>
<p>
目录名就叫localstorage，目录中的结构基本如图：
</p>
<p>
<img src="/images/201501/05.png" alt="localstorage目录结构" />
</p>
<p>
里面除了mainfest.json是必须的，其它东西都可以按自己的习惯来
</p>
<h3>
第二步：建立mainfest.json文件
</h3>
<p>
之前的日志已经讲过这个文件，所以这里就直接帖内容
</p>
<pre class="prettyprint lang-javascript">
{
	"manifest_version": 2,
	"name": "一起来做chrome扩展之本地存储",
	"version": "0.1",
	"description": "一个简单的本地存储例子",
	"background": {
		"scripts": [
			"include/jquery-1.11.0.min.js",	
			"scripts/background.js"
		]
	},
	"content_scripts": [{
		"matches": [
			"http://*.jgb.cn/*",
			"http://*.amazon.com/*"
		],
		"css": ["css/common.css"],
		"js": [
			"include/jquery-1.11.0.min.js",
			"scripts/main.js"
		]
	}]
}
</pre>
<p>
如果对这个文件不熟悉，可以看看<a href="http://fuweiyi.com/chrome%E6%89%A9%E5%B1%95/2014/12/18/a-chrome-extension-01.html" target="_blank">一起来做chrome扩展《基础介绍》</a>
</p>
<p>
把jquery拷贝到include中，再到scripts目录建立main.js和background.js
</p>
<h3>
第三步：创建界面
</h3>
<p>
这里我们创建一个简单的界面，在目标网站的正中间，显示一个500*300的浮动层，正常js，写法随意
</p>
<pre class="prettyprint lang-javascript">
var main = {
	
	/**
	 * 创建界面
	 */
	createHtml: function(){
		var _html = '&lt;div id="ls_box"&gt;'+
			'&lt;h3&gt;'+
				'本地存储 local storage'+
			'&lt;/h3&gt;'+
			'&lt;div id="ls_list"&gt;'+
				'正在加载数据...'+
			'&lt;/div&gt;'+
			'&lt;div id="ls_form"&gt;'+
				'&lt;label&gt;'+
					'新增: '+
				'&lt;/label&gt;'+
				'&lt;input type="text" id="ls_message" /&gt;'+
				'&lt;button id="ls_save"&gt;保存&lt;/button&gt;'+
			'&lt;/div&gt;'+
		'&lt;/div&gt;';
		$('body').append(_html);
	}
}
</pre>
